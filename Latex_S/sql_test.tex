\documentclass[a4paper]{article}
\usepackage{CJK}
\usepackage{geometry}
\usepackage{upgreek}
\usepackage{amsmath}
\usepackage{indentfirst}
\usepackage{url}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{fancybox}
\usepackage{float}
\usepackage{slashbox}
\usepackage{multirow}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{colortbl}
\usepackage{threeparttable}
\pagenumbering{Roman}

\definecolor{mygray}{gray}{.9}

\begin{document}
\begin{CJK}{GBK}{hei}
\author{Joe.zhou}
\title{SQL 测试}
\maketitle

\section{实验环境}
\begin{itemize}
  \item 实验服务器  
    \begin{itemize}
      \item Master Server :
        \begin{description}
          \item[Name : ] testserver2
          \item[Cpu : ] Intel(R) Pentium(R) 4 CPU 2.26GHz
          \item[Memory : ] 1G
          \item[Ip : ] 10.10.10.132
        \end{description}
      \item Slaver Server :
        \begin{description}
          \item[Name : ] faxtest60
          \item[Cpu : ] Intel(R) Pentium(R) 4 CPU 2.26GHz
          \item[Memory : ] 1G
          \item[Ip : ] 10.10.10.131
        \end{description}
    \end{itemize}
  \item 数据版本
    \begin{description}
      \item[MySQL] : \\
        MySQL server community 5.1.52
      \item[PostgreSQL] : \\
        Postgresql 9.0.1-1
    \end{description}      
\end{itemize}

\section{性能测试}
性能测试主要手段是利用Python脚本做大数据插入操作。
因为MySQL的MyISAM存储引擎不支持事务安全，所以测试的MySQL数据库引擎选为具有提交，
回滚和崩溃恢复能力的事务安全（ACID兼容）存储引擎InnoDB。
性能测试的方面主要是数据的插入，数据的修改。

\begin{table}[H]
\centering
\begin{threeparttable}[b]
\caption{数据插入-I【单位秒】}
\begin{tabularx}{7cm}{Xrr}\hline
\toprule
数据量 & MySQL & PostgreSQL \\ \hline \hline
10000 & 24.524 & 16.99 \\ \hline
\rowcolor{mygray}
100000 & 284.048 & 174.640 \\ \hline
1000000 & 2637.916 & 1743.240 \\ \hline
\rowcolor{mygray}
10000000 & 23005.066 & 17885.873 \\ \hline
\bottomrule
\end{tabularx}
\begin{tablenotes}
\item [备注] 空数据表插入
\end{tablenotes}
\end{threeparttable}
\end{table}

\begin{table}[H]
\centering
\begin{threeparttable}[b]
\caption{数据插入-II【单位秒】}
\begin{tabularx}{7cm}{Xrr}\hline
\toprule
原有数据量 & MySQL & PostgreSQL \\ \hline \hline
10000 & 24.437 & 18.404 \\ \hline
100000 & 25.344 & 17.916 \\ \hline
1000000 & 22.494 & 17.888 \\ \hline
10000000 & 25.63 & 17.938 \\ \hline
\bottomrule
\end{tabularx}
\begin{tablenotes}
\item [备注] 已有数据的表再插入10K数据
\end{tablenotes}
\end{threeparttable}
\end{table}

\begin{table}[H]
\begin{center}
\caption{创建索引【单位秒】}
\begin{tabularx}{7cm}{Xrr}\hline
\toprule
数据量 & MySQL & PostgreSQL \\ \hline \hline
10000 & 4 & 0.068 \\ \hline
100000 & 31.73 & 1.382767 \\ \hline
1000000 & 287 & 66.22473 \\ \hline
10000000 & 3201 & 725.110792 \\ \hline
\bottomrule
\end{tabularx}
\end{center}
\end{table}

\begin{table}[H]
\begin{center}
\caption{修改表段【单位秒】}
\begin{tabularx}{7cm}{Xrr}\hline 
\toprule
数据量 & MySQL & PostgreSQL \\ \hline \hline
10000 & 4 & \multicolumn{1}{c}{\multirow{4}*{0.001s}} \\ \cline{1-2}
100000 & 31.73 & \multicolumn{1}{c}{} \\ \cline{1-2}
1000000 & 279 & \multicolumn{1}{c}{} \\ \cline{1-2}
10000000 & 2960 & \multicolumn{1}{c}{} \\ \cline{1-3}
\bottomrule
\end{tabularx}
\end{center}
\end{table}



\begin{table}[H]
\begin{center}
\caption{性能测试}
\begin{tabular}{|p{6cm}|p{3cm}|p{3cm}|}\hline
\backslashbox{\kern+6em 操作}{\kern+6em 用时} & \hfil MySQL & \hfil PostgreSQL \\ \hline

单线程插入20000000条记录 & & \\ \hline
随机查询 & & \\ \hline
随机修改 & & \\ \hline
随机删除 & & \\ \hline
多字段查询 & & \\ \hline
带索引随机查询 & & \\ \hline
带索引多段查询 & & \\ \hline
100个线程同时插入200000条记录 & & \\ \hline
\end{tabular}
\end{center}
\end{table}



\section{同步测试}

\subsection{DML操作同步}

\begin{table}[H]
\begin{center}
\caption{DML操作同步}
\begin{tabular}{c c c c c}\hline \toprule
\multicolumn{2}{c}{\multirow{2}*{操作}} &\multicolumn{2}{c}{MySQL} & PostgreSQL \\ \cline{3-5}
\multicolumn{2}{c}{}                    & RBR & MBR & - \\ \hline \hline
\multicolumn{1}{c}{\multirow{3}*{带索引表}} & 增加记录 & ${\surd}$ & ${\surd}$ & ${\surd}$ \\ \cline{2-5}
\multicolumn{1}{c}{}                        & 修改记录 & ${\surd}$ & ${\surd}$ & ${\surd}$ \\ \cline{2-5}
\multicolumn{1}{c}{}                        & 删除记录 & ${\surd}$ & ${\surd}$ & ${\surd}$ \\ \hline \hline

\multicolumn{1}{c}{\multirow{3}*{无索引表}} & 增加记录 & ${\surd}$ & ${\surd}$ & ${\surd}$ \\ \cline{2-5}
\multicolumn{1}{c}{}                        & 修改记录 & ${\surd}$ & ${\surd}$ & ${\surd}$ \\ \cline{2-5}
\multicolumn{1}{c}{}                        & 删除记录 & ${\surd}$ & ${\surd}$ & ${\surd}$ \\ \hline
\bottomrule
\end{tabular}
\end{center}
\end{table}

\subsection{DDL操作同步}

\begin{table}[H]
\begin{center}
\caption{DDL操作同步}
%\begin{tabular}{c c c c}\hline
\begin{tabularx}{8cm}{Xccc}\hline
\toprule
\multicolumn{1}{l}{\multirow{2}*{操作}} &\multicolumn{2}{c}{MySQL} & PostgreSQL \\ \cline{2-4}
\multicolumn{1}{l}{}                    & RBR & MBR & - \\ \hline \hline
增加表     & ${\surd}$ & ${\surd}$ & ${\surd}$ \\ \hline
删除表     & ${\surd}$ & ${\surd}$ & ${\surd}$ \\ \hline
修改表名   & ${\surd}$ & ${\surd}$ & ${\surd}$ \\ \hline
修改表字段 & ${\surd}$ & ${\surd}$ & ${\surd}$ \\ \hline
增加表索引 & ${\surd}$ & ${\surd}$ & ${\surd}$ \\ \hline
删除表索引 & ${\surd}$ & ${\surd}$ & ${\surd}$ \\ \hline
修改表索引 & ${\surd}$ & ${\surd}$ & ${\texttimes}$ \\ \hline
\bottomrule
\end{tabularx}
\end{center}
\end{table}

\newpage
\begin{verbatim}
CREATE TABLE IF NOT EXISTS `tbl_fax_records3` (
  `faxid` varchar(50) NOT NULL DEFAULT '',
  `taskid` varchar(50) DEFAULT NULL,
  `fax_serv_addr` varchar(30) DEFAULT NULL,
  `userid` varchar(20) DEFAULT NULL,
  `receiver_number` varchar(30) DEFAULT NULL,
  `status` tinyint(4) NOT NULL,
  `fee` decimal(10,3) DEFAULT NULL,
  `time_long` smallint(6) DEFAULT NULL,
  `npages` smallint(6) DEFAULT NULL,
  `error` int(11) DEFAULT NULL,
  `error_descr` varchar(250) DEFAULT NULL,
  `read_count` smallint(6) DEFAULT NULL,
  `fax_start_date` datetime DEFAULT NULL,
  `fax_end_date` datetime DEFAULT NULL,
  `create_date` datetime DEFAULT NULL,
  `jobid` varchar(15) DEFAULT NULL,
  `actual_fee` decimal(10,3) DEFAULT NULL,
  `sip_descr` varchar(200) DEFAULT NULL,
  `submit_date` datetime DEFAULT NULL,
  `kill_date` datetime DEFAULT NULL,
  `ext_delay` tinyint(4) NOT NULL DEFAULT '3',
  `priority` tinyint(4) NOT NULL DEFAULT '1',
  `fax_type` tinyint(4) NOT NULL,
  `ts_type` tinyint(4) NOT NULL DEFAULT '0',
  `origin_error` int(11) DEFAULT NULL,
  `retries` tinyint(4) NOT NULL DEFAULT '0',
  `max_retries` tinyint(4) NOT NULL DEFAULT '2',
  `fax_res` tinyint(4) DEFAULT NULL,
  `fax_dcs` varchar(16) DEFAULT NULL,
  `send_rate` tinyint(4) DEFAULT NULL,
  `send_res` tinyint(4) DEFAULT NULL,
  `send_2D` tinyint(4) DEFAULT NULL,
  `send_ecm` tinyint(4) DEFAULT NULL,
  `retry_type` tinyint(4) NOT NULL DEFAULT '0',
  `recipient` varchar(30) DEFAULT NULL,
  `recipient_company` varchar(100) DEFAULT NULL,
  `area` varchar(5) DEFAULT NULL,
  `number_type` tinyint(4) DEFAULT NULL,
  `hold_times` int(11) DEFAULT NULL,
  PRIMARY KEY (`faxid`),
  KEY `fax_record_taskid` (`taskid`),
  KEY `idx_priority` (`priority`),
  KEY `idx_create_date` (`create_date`),
  KEY `idx_addr` (`fax_serv_addr`),
  KEY `idx_start_date` (`fax_start_date`),
  KEY `idx_kill_date` (`kill_date`),
  KEY `idx_status` (`status`),
  KEY `idx_error` (`error`),
  KEY `idx_fax_type` (`fax_type`),
  KEY `idx_user` (`userid`),
  KEY `idx_number` (`receiver_number`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
\end{verbatim}

\end{CJK}
\end{document} 